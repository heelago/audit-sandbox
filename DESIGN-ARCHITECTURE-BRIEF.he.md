# Audit Sandbox: מסמך ארכיטקטורה ועיצוב (עברית)

## מטרת המסמך
המסמך מתאר את מצב המערכת כפי שהיא היום, כדי שכלי עיצוב/פרוטוטייפ יוכל לדמיין את המבנה הנוכחי במדויק ולבנות רידיזיין UX בלי "ניחושים" על לוגיקה עסקית.

כולל:
- מפת מסכים וניווט
- זרימות משתמשים
- מבנה UI ורכיבים
- תלות בין UI, API ומודל נתונים
- נקודות חיכוך ועומס בעיצוב הנוכחי

---

## תקציר מוצר
Audit Sandbox היא פלטפורמה פדגוגית שבה מרצים יוצרים מטלות המבוססות על טקסטים שנוצרו ע"י AI, וסטודנטים מבצעים ביקורת שיטתית על הטקסט: אי-דיוקים, פערים, ניואנסים חסרים, איכות אימות ועוד. המרצה יוצר/מייצר/מכייל לפני שחרור לסטודנטים, ולאחר מכן סוקר הגשות ודירוגים.

---

## עדכון אחרון (2026-02-24)
- נוסף זרם עבודה של "כשלים נשתלים" (Planted Signals) ליצירת מטלות.
- אותות הכשל נשמרים בתוך `knownPitfalls` בפורמט:
  - `[PLANTED_SIGNALS] ... [/PLANTED_SIGNALS]`
- נוספו פריסטים תחומיים לבחירה מהירה:
  - אקדמי כללי, אנתרופולוגיה איכותנית, היסטוריה של הרפואה העתיקה, תיאוריה ביקורתית, משפטים, ורפואה/חשיבה קלינית.
- בעמוד יצירת מטלה נוספו:
  - בחירת תגיות כשלים
  - בחירת פריסט + החלה בלחיצה
  - הצעת פריסט אוטומטית לפי תוכן המטלה
  - מחולל פרומפט בריינסטורם למרצה ("אילו טעויות כדאי לשתול")
- פרומפט היצירה מותאם לשתילת אותות הכשל שנבחרו.
- פרומפטי הביקורת של הסוכנים נותנים עדיפות לזיהוי אותות שנשתלו, ובמקביל ממשיכים בביקורת כללית.
- מסלול fallback בניתוח שופר:
  - אם Gemini לא מחזיר ממצאים, מתבצעת קודם בדיקת heuristic לפי אותות כשל לפני מעבר ל-placeholder כללי.

---

## סטאק וארכיטקטורה טכנית
- Next.js 16 (App Router), React 19, TypeScript
- Prisma + PostgreSQL
- Authentication מבוסס קוד + Cookie חתום
- אינטגרציית Gemini בצד שרת בלבד
- Firebase App Hosting לפריסה
- Firestore mail queue לשליחת מיילי onboarding

שכבות:
1. Frontend (App Router Pages + Client Components)
2. API Routes (לוגיקה עסקית)
3. Prisma ORM
4. PostgreSQL
5. שירותי תשתית (Firebase/Gemini/Email)

---

## מפת מסכים (Information Architecture)

ציבורי:
- `/` מסך כניסה + טופס בקשת גישה + מודל פילוסופיה
- `/showcase` דמו מודרך (מרצה/סטודנט)

מרצה:
- `/instructor` דשבורד מטלות + ניהול בקשות גישה
- `/instructor/create` יצירת מטלה (Builder + Prompt Editor + Templates + Tour)
- `/instructor/[assignmentId]` תפעול מטלה (generate/analyze/import/edit)
- `/instructor/[assignmentId]/calibrate` כיול ממצאים ושחרור
- `/instructor/[assignmentId]/submissions` טבלת הגשות
- `/instructor/[assignmentId]/submissions/[studentId]` סקירת סטודנט

סטודנט:
- `/student/[assignmentId]` דף נחיתה למטלה
- `/student/[assignmentId]/workspace` סביבת סימון והערות
- `/student/[assignmentId]/report` דוח סיכום

---

## זרימות עיקריות

זרימת מרצה:
1. כניסה עם קוד
2. יצירת מטלה או פתיחת קיימת
3. הגדרת מטרות, קריטריונים, מוקדי קושי ומבנה חלקים
4. בחירת אותות כשל נשתלים / פריסט תחומי / הצעה אוטומטית
5. יצירת טקסטים והרצת ניתוח סוכנים
6. כיול ידני (אישור/דחייה/הוספה/עריכה)
7. שחרור לסטודנטים
8. סקירת הגשות ודירוג

זרימת סטודנט:
1. כניסה עם קוד
2. קריאת המטלה והטקסט
3. סימון קטעים + תיוג + נימוק + ראיות
4. הגשה וצפייה בדוח

זרימת "צופה/מתעניין":
1. נחיתה
2. דמו מודרך ב-showcase
3. בקשת גישה להרצה אמיתית

---

## שפת עיצוב נוכחית

מאפיינים:
- RTL מלא (`dir="rtl"`)
- טיפוגרפיה Heebo
- פלטת צבעים חמימה-נייטרלית (tokens)
- רכיבי UI בסיסיים קיימים: Button, Card, Badge, Input, Textarea, Tabs, StatCard

מצב בפועל:
- חלק מהמסכים משתמשים היטב ברכיבים
- חלק גדול מהמסכים נשען על inline styles וקוד מונוליטי
- עקביות ויזואלית חלקית בלבד

---

## תלות UX ב-API

סטטוס מטלה (state machine):
- `draft -> generating -> analyzing -> calibrating -> active -> grading -> closed`

API מרכזיים:
- `POST /api/auth`, `GET /api/auth/session`
- `GET/POST /api/assignments`
- `GET/PATCH /api/assignments/[id]`
- `POST /api/assignments/[id]/generate`
- `POST /api/assignments/[id]/analyze`
- `POST /api/assignments/[id]/calibrate`
- `POST /api/assignments/[id]/release`
- `POST /api/annotations`, `PUT/DELETE /api/annotations/[id]`
- `POST/GET/PUT /api/scoring/[textId]`
- `GET/POST /api/access-requests`, `PATCH /api/access-requests/[id]`

השלכה עיצובית:
- לכל כפתור "פעולה" במסכי מרצה יש משמעות תהליכית אמיתית; אסור לעצב את זה כטוגל קוסמטי בלבד.

---

## מודל נתונים (פרקטי לעיצוב)

ישויות עיקריות:
- Assignment
- GeneratedText
- RubricItem
- Annotation + Evidence
- Score + RubricMatch
- AgentAnalysisReport + AgentAnalysisFinding
- AccessRequest + InstructorAccess

השלכה עיצובית:
- ניתן להציג יותר תובנות למרצה (למשל היסטוריית ריצות סוכנים) בלי לשנות backend, רק ע"י UX ברור יותר.

---

## נקודות עומס/חוב UX כרגע

1. מסך הבית עמוס תפקידים:
- Login + טופס בקשה + הסבר מתודולוגי באותו מקום.

2. דשבורד מרצה מעורבב:
- תפעול פדגוגי וניהול אדמין (בקשות גישה) יושבים יחד.

3. מסך יצירת מטלה עמוס החלטות:
- עוצמתי, אבל קוגניטיבית קשה למרצים חדשים.
- למרות שיפור הפריסטים וההצעות האוטומטיות, עדיין נדרש פישוט זרימה רב-שלבית כדי להפחית עומס.

4. מסכי מונולית:
- קבצי עמוד ארוכים מאוד, קשה לבצע שיפורי UX נקודתיים.

5. עקביות רכיבים:
- קיימת תשתית design system, אבל לא נאכפת מספיק בפועל.

---

## אילוצים שחייבים להישמר ברידיזיין

חובה לשמר:
- RTL ועברית כ-first class
- הפרדה בין תפקיד מרצה/סטודנט
- state machine של המטלה
- תמיכה במטלה עד 3 חלקים
- כיול מרצה לפני שחרור
- סימון טקסט + ראיות כלב המוצר

אסור לחשוף:
- מפתחות/סודות
- פרומפטים פנימיים מלאים לסטודנט
- לוגיקה פנימית שאמורה להישאר שרתית

---

## כיוון מוצע לרידיזיין

1. פישוט IA:
- Landing נקי עם 4 נתיבים: כניסה, דמו, בקשת גישה, "מה זה ולמה".

2. יצירת מטלה כ-Wizard:
- שלב 1: מטרת מטלה והקשר קורס
- שלב 2: חלקים/קריטריונים/מוקדי קושי
- שלב 3: יצירה + תצוגה מקדימה
- שלב 4: ניתוח סוכנים + כיול + שחרור

3. הפרדת אדמין:
- בקשות גישה למסך נפרד/טאב נפרד מהדשבורד הפדגוגי.

4. סטודנט:
- להשאיר סימון טקסט, אבל לשפר היררכיה וניהול קשב בצד ההערות.

5. תחזוקה:
- פירוק מסכים גדולים לרכיבי-דומיין קטנים (builder, generation, calibration, annotation panel).

---

## קבצים מרכזיים לרפרנס
- `src/app/page.tsx`
- `src/app/showcase/page.tsx`
- `src/app/instructor/create/page.tsx`
- `src/app/instructor/[assignmentId]/page.tsx`
- `src/app/instructor/[assignmentId]/calibrate/page.tsx`
- `src/app/student/[assignmentId]/workspace/page.tsx`
- `prisma/schema.prisma`
- `src/lib/ai/prompt-config.ts`

---

## פרומפט קצר לכלי עיצוב (עברית)

"עצבי מחדש פלטפורמת RTL בעברית בשם Audit Sandbox. למרצה: יצירת מטלות AI, בחירת קריטריונים ומוקדי כשל (עד 3 חלקים), הרצת סוכני ביקורת, כיול ושחרור. לסטודנט: סימון טקסט, תיוג בעיות, נימוק וראיות, והגשה. המטרה: להפחית עומס קוגניטיבי ולשמר יכולת מקצועית עמוקה. לעצב חוויית Wizard ברורה למרצה, סביבת עבודה ממוקדת לסטודנט, והפרדה בין תפעול פדגוגי לאדמין. לשמור טון אקדמי נקי, מודרני, ולא טכני מדי."
